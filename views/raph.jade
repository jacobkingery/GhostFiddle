extends layout

block header_scripts

    script(src='/javascripts/raphael.js')
    //- style.
        html {
            height: 100%;
            padding: 0;
            margin: 0;
        }
        body {
            position: absolute;
            top: 0;
            left: 0;
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
            min-width: 100%;
        }

    script.

        window.onload = function() {
            var W = 1000,
                H = 700,
                r = Raphael("raphHolder", W, H),
                lenSong = 12,
                numGlass = 6,
                values = [],
                fill = ['#87E8D6','#FAE13C','#E43CFA','#3CFA58','#F24B96','#593AB5'];
            // Data storage    
            for (var i = 0; i < numGlass; i++) {
                values.push([])
                for (var j = 0; j < lenSong; j++){
                    values[i].push(0);
                }
            }

            // Note selectors
            for (var i = numGlass; i--;) {
                for (var j = lenSong; j--;){
                    r.circle(40+80*j,40+80*i, 10)
                    .attr({fill: fill[i], stroke: fill[i], 'stroke-width': 2, 'fill-opacity': values[i][j], 'stroke-opacity': 1})
                    .data('x', j)
                    .data('y',i)
                    .click(function () {
                        var new_op = +!this.attr('fill-opacity');
                        values[this.data('y')][this.data('x')] = new_op;                        
                        this.animate({'fill-opacity' : new_op}, 200);
                    })
                    .hover(function() {
                        this.animate({ r: 20 }, 100,'elastic');
                    },
                    function() {
                        if (!values[this.data('y')][this.data('x')]){
                            this.animate({ r: 10 }, 100,'elastic');
                        }
                    });
                }
            }

            // Submit button
            var subRect =
            r.rect(50, 500, 200, 60, 20)
                .attr({fill: "#3C850C", stroke: "#326E0A", 'stroke-width': 2, 'fill-opacity': .75, 'stroke-opacity': 1})
                
            var subText = 
            r.text(150,530,"Submit Song!")
                .attr({fill: "#FFFFFF", "font-size": 32, "font-family": "Helvetica" })
            var subButton = r.set()
                .attr({cursor: "pointer"});
            subButton.push(subRect);
            subButton.push(subText);
            subButton.hover(function() {
                subRect.animate({'fill-opacity' : 1}, 200);
                },
                function() {
                subRect.animate({'fill-opacity' : .75}, 200);
                })
            subButton.click(function() {
                var s = "";
                   console.log(values);
                   for (var i = 0; i < numGlass; i++){
                       console.log(values[i]);
                       s += values[i].join('')+"\n";
                   }
                   console.log(s);
                   document.getElementById('glass0').value = s;
                   document.getElementById('newSong').submit();
            });

        };


block content

    div(id="raphHolder")
    div(id="formHolder")
        form(id="newSong", method="post", action="/submit")
            input(id="glass0", type="hidden", name="glass0")
    //- div(id="footer")
        | <b><a href='http://github.com/jacobkingery/GhostFiddle' style='color: #111;'>Team Ghost Fiddle</a></b>
